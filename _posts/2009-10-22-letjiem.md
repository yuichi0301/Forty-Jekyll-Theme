---
layout: post
title: XQueryの勉強・let節
description: XQueryの勉強・let節
---
1.前置き
今回はlet節の勉強です。
XQueryの構文がフラワー式と呼ばれるのは次のような理由からです。

[XQueryの構文]
```xquery
for節
let節
where節
order by節
return節
```
この頭文字をとってFLWOR→フラワーときています。
今回はこのlet節です。

2.forとletの違い
forとletの違いはreturnの振る舞いの違いになります。
forの場合格納したシーケンスを順に１つずつreturnで処理するのに対し、
letの場合格納したシーケンスを一気にreturnで処理します。

3.試してみる。(for節の場合)
試してみるクエリは以下のクエリになります。

```xquery
for $result in doc("test4.xml")/othelloList/othello
return
<test>{$result}</test>
```


結果は次のようになりました。

```xml
<?xml version="1.0" encoding="UTF-8"?>
<test>
	<othello name="takeshi">
		<result>win</result>
		<result>lose</result>
		<result>win</result>
	</othello>
</test>
<test>
	<othello name="yuichi">
		<result>win</result>
		<result>win</result>
		<result>win</result>
	</othello>
</test>
<test>
	<othello name="tetu">
		<result>lose</result>
		<result>lose</result>
		<result>lose</result>
	</othello>
</test>
```


出力されたシーケンスのおのおの全てがtest要素の中に入ります。

4.試してみる。(let節の場合)
試してみるクエリは以下のクエリになります。

```xquery
let $result := doc("test4.xml")/othelloList/othello
return
<test>{$result}</test>
```


※forの場合のinの部分が:=になることも注意です。
結果は次のようになりました。

```xml
<?xml version="1.0" encoding="UTF-8"?>
<test>
	<othello name="takeshi">
		<result>win</result>
		<result>lose</result>
		<result>win</result>
	</othello>
	<othello name="yuichi">
		<result>win</result>
		<result>win</result>
		<result>win</result>
	</othello
	<
	<othello name="tetu">
		<result>lose</result>
		<result>lose</result>
		<result>lose</result>
	</othello>
</test>
```


出力されたシーケンス全体がtest要素の中に入ります。
